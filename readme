# web-dtool-service

合宙差分包生成服务

代码使用flask框架
用uwsgi直接起http服务。也可以自行配置，放在nginx之后。
运行在linux系统

---

src包含代码

python3_8_3_dtool_app.df为镜像描述(dockerfile)

python3_8_3_dtool_app_requirements.txt为代码所需的python库，会在dockerfile中进行安装。

docker-compose.yaml是docker-compose配置。

dtool_uwsgi.ini是uwsgi配置

---

用户可以自行安装python库，自己运行服务。
安装环境参考上述配置文件。

pip3 install -i https://pypi.doubanio.com/simple/ --trusted-host pypi.doubanio.com -r python3_8_3_dtool_app_requirements.txt

安装完后运行
uwsgi --ini web-dtool-service/dtool_uwsgi.ini

---

用户也可以在docker环境中运行服务。推荐用docker运行。

进入web-dtool-service目录

1. 生成镜像
sudo docker build -f python3_8_3_dtool_app.df -t python3_8_3_dtool_app .

2. 启动dtool
sudo docker-compose up -d dtool

3. 查看log
sudo docker-compose logs dtool

4. 查看状态
sudo docker-compose ps

如果state是UP说明已经跑起来了。

---

接口地址
http://你的ip:30030/api/site/dfota_diff_image
30030可在docker-compose.yaml改为其他端口比如常用的80。

form参数
两个文件。文件名为f1和f2。

返回
若成功返回http 200。附带文件。
若失败返回http 400等。带错误信息msg。


---

差分工具可执行文件在/web-dtool-service/src/app/third_party/dfota/。
需要设置为可执行。

---
